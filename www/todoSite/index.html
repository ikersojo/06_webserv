<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TODO App</title>
	<style>
		body {
			background-color: black;
			color: white;
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
			height: 100vh;
		}

		h1 {
			text-align: center;
			margin-bottom: 20px;
		}

		form {
			text-align: center;
			margin-bottom: 20px;
		}

		label {
			margin-right: 10px;
		}

		input {
			padding: 5px;
		}

		button {
			padding: 5px 10px;
			background-color: #3498db;
			color: white;
			border: none;
			cursor: pointer;
			margin-bottom: 5px;
		}

		ul {
			list-style-type: none;
			padding: 0;
			margin: 0;
		}

		li {
			margin-bottom: 10px;
		}
	</style>
</head>
<body>

<h1>TODO App</h1>

<form id="todoForm">
	<label for="task">Task:</label>
	<input type="text" id="task" name="task" required>
	<button type="submit">Add Task</button>
</form>

<ul id="taskList"></ul>

<script>
// Function to fetch and update the task list
function updateTaskList() {
	fetch("http://localhost:80/api")
		.then(response => {
			if (!response.ok) {
				throw new Error("Network response was not ok");
			}
			return response.json();
		})
		.then(tasks => {
			// Update the task list in the HTML
			const taskListElement = document.getElementById("taskList");
			taskListElement.innerHTML = tasks.map(task => `<li>${task} <button class="deleteButton" data-task="${task}">Delete</button></li>`).join("");

			// Attach event listeners to delete buttons
			const deleteButtons = document.querySelectorAll('.deleteButton');
			deleteButtons.forEach(button => {
				button.addEventListener('click', function() {
					const taskToDelete = this.getAttribute('data-task');
					deleteTask(taskToDelete);
				});
			});
		})
		.catch(error => {
			console.error("Error fetching task list:", error);
		});
}

// Function to delete a task
function deleteTask(task) {
	// Send a DELETE request to the server
	fetch(`http://localhost:80/api/${task}`, {
		method: "DELETE",
	})
	.then(response => {
		if (!response.ok) {
			throw new Error("Network response was not ok");
		}
		return response.text();
	})
	.then(data => {
		console.log("DELETE request successful:", data);
		// Update the task list after a successful DELETE request
		updateTaskList();
	})
	.catch(error => {
		console.error("Error during DELETE request:", error);
	});
}

// Attach the submit event listener to the form
document.getElementById("todoForm").addEventListener("submit", function(event) {
	event.preventDefault();

	// Get the task from the input field
	const task = document.getElementById("task").value;
	const taskInput = document.getElementById("task");

	// Create a JSON object with the task
	const postData = { task: task };

	// Send a POST request to the server
	fetch("http://localhost:80/api", {
		method: "POST",
		headers: {
			"Content-Type": "application/json",
		},
		body: JSON.stringify(postData),
	})
	.then(response => {
		if (!response.ok) {
			throw new Error("Network response was not ok");
		}
		return response.text();
	})
	.then(data => {
		console.log("POST request successful:", data);
		// Update the task list after a successful POST request
		updateTaskList();
		taskInput.value = "";
	})
	.catch(error => {
		console.error("Error during POST request:", error);
	});
});

// Initial update of the task list
updateTaskList();
</script>

</body>
</html>
